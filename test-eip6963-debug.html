<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EIP-6963 é’±åŒ…è¿æ¥æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .wallet-item {
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .wallet-item:hover {
            border-color: #3b82f6;
            background: #f8faff;
        }
        .wallet-item.selected {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .log {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #6b7280;
            padding-left: 10px;
        }
        .log-entry.info { border-left-color: #3b82f6; }
        .log-entry.success { border-left-color: #10b981; }
        .log-entry.error { border-left-color: #ef4444; }
        .log-entry.warn { border-left-color: #f59e0b; }
        
        /* ç½‘ç»œç®¡ç†æ ·å¼ */
        #network-management {
            margin-top: 30px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .network-section {
            margin-bottom: 25px;
        }
        
        .network-section h3 {
            margin-bottom: 15px;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 8px;
        }
        
        .network-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .network-templates button {
            background: #10b981;
            padding: 10px 16px;
            font-size: 14px;
        }
        
        .network-templates button:hover {
            background: #059669;
        }
        
        #custom-network-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            margin-top: 15px;
        }
        
        #custom-network-form input {
            width: 100%;
            margin: 8px 0;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        #custom-network-form input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: #6b7280;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        .switch-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
        }
        
        .switch-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .switch-options button {
            background: #f59e0b;
            font-size: 13px;
            padding: 8px 12px;
        }
        
        .switch-options button:hover {
            background: #d97706;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— EIP-6963 é’±åŒ…è¿æ¥æµ‹è¯•</h1>
        
        <div id="wallet-detection">
            <h2>ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹é’±åŒ…</h2>
            <button onclick="detectWallets()">ğŸ” æ£€æµ‹å¯ç”¨é’±åŒ…</button>
            <div id="wallets-list"></div>
        </div>

        <div id="wallet-connection">
            <h2>ç¬¬äºŒæ­¥ï¼šè¿æ¥é’±åŒ…</h2>
            <button onclick="connectSelectedWallet()" id="connect-btn" disabled>ğŸ”— è¿æ¥é€‰ä¸­çš„é’±åŒ…</button>
        </div>

        <div id="wallet-interaction">
            <h2>ç¬¬ä¸‰æ­¥ï¼šé’±åŒ…äº¤äº’</h2>
            <button onclick="getAccounts()" disabled id="accounts-btn">ğŸ‘¤ è·å–è´¦æˆ·</button>
            <button onclick="getChainId()" disabled id="chain-btn">ğŸŒ è·å–é“¾ID</button>
            <button onclick="signMessage()" disabled id="sign-btn">âœï¸ ç­¾åæ¶ˆæ¯</button>
            <button onclick="addNetwork()" disabled id="add-network-btn">â• æ·»åŠ ç½‘ç»œ</button>
            <button onclick="switchNetwork()" disabled id="switch-network-btn">ğŸ”„ åˆ‡æ¢ç½‘ç»œ</button>
        </div>

        <div id="results">
            <h2>ğŸ“Š ç»“æœæ˜¾ç¤º</h2>
            <div id="account-info"></div>
            <div id="chain-info"></div>
        </div>

        <!-- ç½‘ç»œç®¡ç†æµ‹è¯•åŒºåŸŸ -->
        <div id="network-management">
            <h2>ğŸŒ ç½‘ç»œç®¡ç†æµ‹è¯• (EIP-3085)</h2>
            
            <div class="network-section">
                <h3>ğŸš€ é¢„è®¾ç½‘ç»œæ¨¡æ¿</h3>
                <div class="network-templates">
                    <button onclick="addGnosisChain()">ğŸŸ¢ æ·»åŠ  Gnosis Chain</button>
                    <button onclick="addPolygonChain()">ğŸŸ£ æ·»åŠ  Polygon</button>
                    <button onclick="addBSCChain()">ğŸŸ¡ æ·»åŠ  BSC</button>
                    <button onclick="addArbitrumChain()">ğŸ”µ æ·»åŠ  Arbitrum</button>
                    <button onclick="addOptimismChain()">ğŸ”´ æ·»åŠ  Optimism</button>
                    <button onclick="addAvalancheChain()">âšª æ·»åŠ  Avalanche</button>
                    <button onclick="addSolanaDevnetChain()">ğŸŸ  æ·»åŠ  Solana Devnet</button>
                </div>
            </div>

            <div class="network-section">
                <h3>âš™ï¸ è‡ªå®šä¹‰ç½‘ç»œ</h3>
                <button onclick="showCustomNetworkForm()" id="show-form-btn">â• æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ</button>
                
                <div id="custom-network-form" style="display: none;">
                    <div class="form-group">
                        <label for="chain-id">é“¾ID *</label>
                        <input type="text" id="chain-id" placeholder="åå…­è¿›åˆ¶æ ¼å¼ï¼Œå¦‚ 0x89 æˆ–åè¿›åˆ¶ 137">
                    </div>
                    
                    <div class="form-group">
                        <label for="chain-name">ç½‘ç»œåç§° *</label>
                        <input type="text" id="chain-name" placeholder="å¦‚ Polygon Mainnet">
                    </div>
                    
                    <div class="form-group">
                        <label for="rpc-url">RPC URL *</label>
                        <input type="text" id="rpc-url" placeholder="https://polygon-rpc.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="currency-name">è´§å¸åç§° *</label>
                        <input type="text" id="currency-name" placeholder="å¦‚ Matic Token">
                    </div>
                    
                    <div class="form-group">
                        <label for="currency-symbol">è´§å¸ç¬¦å· *</label>
                        <input type="text" id="currency-symbol" placeholder="å¦‚ MATIC">
                    </div>
                    
                    <div class="form-group">
                        <label for="currency-decimals">è´§å¸ç²¾åº¦</label>
                        <input type="number" id="currency-decimals" placeholder="18" value="18">
                    </div>
                    
                    <div class="form-group">
                        <label for="block-explorer">åŒºå—æµè§ˆå™¨ URL (å¯é€‰)</label>
                        <input type="text" id="block-explorer" placeholder="https://polygonscan.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="icon-url">å›¾æ ‡ URL (å¯é€‰)</label>
                        <input type="text" id="icon-url" placeholder="https://example.com/icon.png">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="hideCustomNetworkForm()">å–æ¶ˆ</button>
                        <button type="button" onclick="addCustomNetwork()">æ·»åŠ ç½‘ç»œ</button>
                    </div>
                </div>
            </div>

            <div class="network-section">
                <h3>ğŸ”„ ç½‘ç»œåˆ‡æ¢æµ‹è¯•</h3>
                <div class="switch-section">
                    <p>æµ‹è¯• wallet_switchEthereumChain æ–¹æ³•:</p>
                    <div class="switch-options">
                        <button onclick="switchToChain('0x1')">åˆ‡æ¢åˆ°ä¸»ç½‘</button>
                        <button onclick="switchToChain('0xaa36a7')">åˆ‡æ¢åˆ° Sepolia</button>
                        <button onclick="switchToChain('0x89')">åˆ‡æ¢åˆ° Polygon</button>
                        <button onclick="switchToChain('0x38')">åˆ‡æ¢åˆ° BSC</button>
                        <button onclick="switchToChain('0xa4b1')">åˆ‡æ¢åˆ° Arbitrum</button>
                        <!-- æ–°å¢Solanaåˆ‡æ¢æŒ‰é’® -->
                        <button onclick="switchToSolana('mainnet')">åˆ‡æ¢åˆ° Solana Mainnet</button>
                        <button onclick="switchToSolana('devnet')">åˆ‡æ¢åˆ° Solana Devnet</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="logs">
            <h2>ğŸ“ è¯¦ç»†æ—¥å¿—</h2>
            <button onclick="clearLogs()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
            <div class="log" id="log-container"></div>
        </div>
    </div>

    <script>
        let discoveredWallets = new Map();
        let selectedWallet = null;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span style="color: #6b7280;">[${timestamp}]</span> ${message}`;
            
            const logContainer = document.getElementById('log-container');
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('log-container').innerHTML = '';
        }

        // ç›‘å¬é’±åŒ…å®£å‘Š
        window.addEventListener("eip6963:announceProvider", (event) => {
            const { info, provider } = event.detail;
            log(`ğŸ” å‘ç°é’±åŒ…: ${info.name} (UUID: ${info.uuid})`, 'success');
            
            discoveredWallets.set(info.uuid, { info, provider });
            displayWallets();
        });

        // è¯·æ±‚é’±åŒ…å®£å‘Š
        function detectWallets() {
            log('ğŸ” å¼€å§‹æ£€æµ‹é’±åŒ…...', 'info');
            discoveredWallets.clear();
            
            // æ¸…ç©ºæ˜¾ç¤º
            document.getElementById('wallets-list').innerHTML = '';
            
            // å‘é€è¯·æ±‚äº‹ä»¶
            window.dispatchEvent(new CustomEvent("eip6963:requestProvider"));
            
            // ç­‰å¾…ä¸€æ®µæ—¶é—´æ”¶é›†é’±åŒ…
            setTimeout(() => {
                if (discoveredWallets.size === 0) {
                    log('âŒ æ²¡æœ‰æ£€æµ‹åˆ°æ”¯æŒ EIP-6963 çš„é’±åŒ…', 'warn');
                } else {
                    log(`âœ… æ£€æµ‹åˆ° ${discoveredWallets.size} ä¸ªé’±åŒ…`, 'success');
                }
            }, 1000);
        }

        function displayWallets() {
            const walletsList = document.getElementById('wallets-list');
            walletsList.innerHTML = '';

            for (const [uuid, { info, provider }] of discoveredWallets) {
                const walletDiv = document.createElement('div');
                walletDiv.className = 'wallet-item';
                walletDiv.onclick = () => selectWallet(uuid);
                
                walletDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <img src="${info.icon}" alt="${info.name}" style="width: 32px; height: 32px; border-radius: 6px;">
                        <div>
                            <div style="font-weight: 600;">${info.name}</div>
                            <div style="font-size: 12px; color: #6b7280;">UUID: ${uuid}</div>
                        </div>
                    </div>
                `;
                
                walletsList.appendChild(walletDiv);
            }
        }

        function selectWallet(uuid) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.wallet-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // é€‰æ‹©æ–°çš„é’±åŒ…
            event.target.closest('.wallet-item').classList.add('selected');
            selectedWallet = discoveredWallets.get(uuid);
            
            log(`ğŸ‘† é€‰æ‹©é’±åŒ…: ${selectedWallet.info.name}`, 'info');
            document.getElementById('connect-btn').disabled = false;
        }

        async function connectSelectedWallet() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé’±åŒ…', 'error');
                return;
            }

            try {
                log(`ğŸ”— æ­£åœ¨è¿æ¥ ${selectedWallet.info.name}...`, 'info');
                
                const accounts = await selectedWallet.provider.request({
                    method: "eth_requestAccounts"
                });
                
                log(`âœ… è¿æ¥æˆåŠŸ! è·å¾—è´¦æˆ·: ${accounts.join(', ')}`, 'success');
                
                // å¯ç”¨å…¶ä»–æŒ‰é’®
                document.getElementById('accounts-btn').disabled = false;
                document.getElementById('chain-btn').disabled = false;
                document.getElementById('sign-btn').disabled = false;
                document.getElementById('add-network-btn').disabled = false;
                document.getElementById('switch-network-btn').disabled = false;
                
                // æ˜¾ç¤ºè´¦æˆ·ä¿¡æ¯
                document.getElementById('account-info').innerHTML = `
                    <strong>å·²è¿æ¥è´¦æˆ·:</strong> ${accounts[0]}<br>
                    <strong>é’±åŒ…:</strong> ${selectedWallet.info.name}
                `;
                
                // è·å–å½“å‰é“¾ID
                await getChainId();
                
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                console.error('è¿æ¥å¤±è´¥:', error);
            }
        }

        async function getAccounts() {
            if (!selectedWallet) return;
            
            try {
                log('ğŸ‘¤ è·å–è´¦æˆ·åˆ—è¡¨...', 'info');
                const accounts = await selectedWallet.provider.request({
                    method: "eth_accounts"
                });
                log(`âœ… è´¦æˆ·: ${accounts.join(', ')}`, 'success');
            } catch (error) {
                log(`âŒ è·å–è´¦æˆ·å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function getChainId() {
            if (!selectedWallet) return;
            
            try {
                log('ğŸŒ è·å–é“¾ID...', 'info');
                const chainId = await selectedWallet.provider.request({
                    method: "eth_chainId"
                });
                log(`âœ… é“¾ID: ${chainId} (${parseInt(chainId, 16)})`, 'success');
                
                const networkName = getNetworkName(chainId);
                document.getElementById('chain-info').innerHTML = `
                    <strong>å½“å‰ç½‘ç»œ:</strong> ${networkName}<br>
                    <strong>é“¾ID:</strong> ${chainId} (${parseInt(chainId, 16)})
                `;
            } catch (error) {
                log(`âŒ è·å–é“¾IDå¤±è´¥: ${error.message}`, 'error');
            }
        }

        function getNetworkName(chainId) {
            const networks = {
                '0x1': 'Ethereum Mainnet',
                '0xaa36a7': 'Sepolia Testnet',
                '0x89': 'Polygon',
                '0x38': 'BSC',
                '0xa4b1': 'Arbitrum One',
                '0xa': 'Optimism',
                '0xa86a': 'Avalanche',
                '0x64': 'Gnosis Chain'
            };
            return networks[chainId] || 'æœªçŸ¥ç½‘ç»œ';
        }

        async function signMessage() {
            if (!selectedWallet) return;
            
            try {
                log('âœï¸ è¯·æ±‚ç­¾åæ¶ˆæ¯...', 'info');
                const accounts = await selectedWallet.provider.request({
                    method: "eth_accounts"
                });
                
                if (accounts.length === 0) {
                    log('âŒ æ²¡æœ‰å¯ç”¨è´¦æˆ·', 'error');
                    return;
                }
                
                const message = "Hello from EIP-6963 test!";
                const signature = await selectedWallet.provider.request({
                    method: "personal_sign",
                    params: [message, accounts[0]]
                });
                
                log(`âœ… ç­¾åæˆåŠŸ: ${signature}`, 'success');
            } catch (error) {
                log(`âŒ ç­¾åå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ==================== ç½‘ç»œç®¡ç†åŠŸèƒ½ ====================

        async function addNetwork() {
            if (!selectedWallet) return;
            
            try {
                log('ğŸŒ æµ‹è¯•æ·»åŠ ç½‘ç»œåŠŸèƒ½...', 'info');
                await addGnosisChain();
            } catch (error) {
                log(`âŒ æ·»åŠ ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¢„è®¾ç½‘ç»œé…ç½®
        async function addGnosisChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const gnosisConfig = {
                chainId: '0x64', // 100
                chainName: 'Gnosis Chain',
                rpcUrls: ['https://rpc.gnosischain.com'],
                nativeCurrency: {
                    name: 'xDAI',
                    symbol: 'xDAI',
                    decimals: 18
                },
                blockExplorerUrls: ['https://gnosisscan.io'],
                iconUrls: ['https://xdaichain.com/fake/example/url/xdai.svg']
            };
            
            try {
                log('ğŸŸ¢ è¯·æ±‚æ·»åŠ  Gnosis Chain...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [gnosisConfig]
                });
                log('âœ… Gnosis Chain æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Gnosis Chain å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function addPolygonChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const polygonConfig = {
                chainId: '0x89', // 137
                chainName: 'Polygon',
                rpcUrls: ['https://polygon-rpc.com'],
                nativeCurrency: {
                    name: 'MATIC',
                    symbol: 'MATIC',
                    decimals: 18
                },
                blockExplorerUrls: ['https://polygonscan.com'],
                iconUrls: ['https://wallet-asset.matic.network/img/tokens/matic.svg']
            };
            
            try {
                log('ğŸŸ£ è¯·æ±‚æ·»åŠ  Polygon...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [polygonConfig]
                });
                log('âœ… Polygon æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Polygon å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // solanaæµ‹è¯•é“¾
        async function addSolanaDevnetChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }

            const solanaConfig = {
                chainId: '0x1', // 1
                chainName: 'Solana Devnet',
                rpcUrls: ['https://api.devnet.solana.com'],
                nativeCurrency: {
                    name: 'SOL',
                    symbol: 'SOL',
                    decimals: 9
                },
                blockExplorerUrls: ['https://explorer.solana.com'],
                iconUrls: ['https://solana.com/favicon.ico']
            };
            
            try {
                log('ğŸŸ£ è¯·æ±‚æ·»åŠ  Solana Devnet...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [solanaConfig]
                });
                log('âœ… Solana Devnet æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Solana Devnet å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function addBSCChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const bscConfig = {
                chainId: '0x38', // 56
                chainName: 'BNB Smart Chain',
                rpcUrls: ['https://bsc-dataseed.binance.org'],
                nativeCurrency: {
                    name: 'BNB',
                    symbol: 'BNB',
                    decimals: 18
                },
                blockExplorerUrls: ['https://bscscan.com'],
                iconUrls: ['https://s2.coinmarketcap.com/static/img/coins/64x64/1839.png']
            };
            
            try {
                log('ğŸŸ¡ è¯·æ±‚æ·»åŠ  BNB Smart Chain...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [bscConfig]
                });
                log('âœ… BNB Smart Chain æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  BNB Smart Chain å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function addArbitrumChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const arbitrumConfig = {
                chainId: '0xa4b1', // 42161
                chainName: 'Arbitrum One',
                rpcUrls: ['https://arb1.arbitrum.io/rpc'],
                nativeCurrency: {
                    name: 'Ethereum',
                    symbol: 'ETH',
                    decimals: 18
                },
                blockExplorerUrls: ['https://arbiscan.io'],
                iconUrls: ['https://bridge.arbitrum.io/logo.png']
            };
            
            try {
                log('ğŸ”µ è¯·æ±‚æ·»åŠ  Arbitrum One...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [arbitrumConfig]
                });
                log('âœ… Arbitrum One æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Arbitrum One å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function addOptimismChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const optimismConfig = {
                chainId: '0xa', // 10
                chainName: 'Optimism',
                rpcUrls: ['https://mainnet.optimism.io'],
                nativeCurrency: {
                    name: 'Ethereum',
                    symbol: 'ETH',
                    decimals: 18
                },
                blockExplorerUrls: ['https://optimistic.etherscan.io'],
                iconUrls: ['https://ethereum-optimism.github.io/optimism-tutorial/assets/optimism.svg']
            };
            
            try {
                log('ğŸ”´ è¯·æ±‚æ·»åŠ  Optimism...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [optimismConfig]
                });
                log('âœ… Optimism æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Optimism å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function addAvalancheChain() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const avalancheConfig = {
                chainId: '0xa86a', // 43114
                chainName: 'Avalanche C-Chain',
                rpcUrls: ['https://api.avax.network/ext/bc/C/rpc'],
                nativeCurrency: {
                    name: 'Avalanche',
                    symbol: 'AVAX',
                    decimals: 18
                },
                blockExplorerUrls: ['https://snowtrace.io'],
                iconUrls: ['https://images.ctfassets.net/gcj8jwzm6086/5VHupNKwnDYJvqMENeV7iJ/fdd6326b7a82c8388e4ee9d4be7062d4/avalanche-avax-logo.svg']
            };
            
            try {
                log('âšª è¯·æ±‚æ·»åŠ  Avalanche C-Chain...', 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [avalancheConfig]
                });
                log('âœ… Avalanche C-Chain æ·»åŠ æˆåŠŸ!', 'success');
            } catch (error) {
                log(`âŒ æ·»åŠ  Avalanche C-Chain å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰ç½‘ç»œè¡¨å•
        function showCustomNetworkForm() {
            const form = document.getElementById('custom-network-form');
            form.style.display = 'block';
            document.getElementById('show-form-btn').textContent = 'âŒ å–æ¶ˆæ·»åŠ ';
            document.getElementById('show-form-btn').onclick = hideCustomNetworkForm;
        }

        function hideCustomNetworkForm() {
            const form = document.getElementById('custom-network-form');
            form.style.display = 'none';
            document.getElementById('show-form-btn').textContent = 'â• æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ';
            document.getElementById('show-form-btn').onclick = showCustomNetworkForm;
            
            // æ¸…ç©ºè¡¨å•
            clearCustomNetworkForm();
        }

        function clearCustomNetworkForm() {
            document.getElementById('chain-id').value = '';
            document.getElementById('chain-name').value = '';
            document.getElementById('rpc-url').value = '';
            document.getElementById('currency-name').value = '';
            document.getElementById('currency-symbol').value = '';
            document.getElementById('currency-decimals').value = '18';
            document.getElementById('block-explorer').value = '';
            document.getElementById('icon-url').value = '';
        }

        // æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ
        async function addCustomNetwork() {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const chainId = document.getElementById('chain-id').value;
            const chainName = document.getElementById('chain-name').value;
            const rpcUrl = document.getElementById('rpc-url').value;
            const currencyName = document.getElementById('currency-name').value;
            const currencySymbol = document.getElementById('currency-symbol').value;
            const currencyDecimals = parseInt(document.getElementById('currency-decimals').value) || 18;
            const blockExplorer = document.getElementById('block-explorer').value;
            const iconUrl = document.getElementById('icon-url').value;
            
            if (!chainId || !chainName || !rpcUrl || !currencyName || !currencySymbol) {
                log('âŒ è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            // å¤„ç†é“¾IDæ ¼å¼
            let formattedChainId = chainId;
            if (!chainId.startsWith('0x')) {
                formattedChainId = `0x${parseInt(chainId).toString(16)}`;
            }
            
            const customConfig = {
                chainId: formattedChainId,
                chainName: chainName,
                rpcUrls: [rpcUrl],
                nativeCurrency: {
                    name: currencyName,
                    symbol: currencySymbol,
                    decimals: currencyDecimals
                }
            };
            
            if (blockExplorer) {
                customConfig.blockExplorerUrls = [blockExplorer];
            }
            
            if (iconUrl) {
                customConfig.iconUrls = [iconUrl];
            }
            
            try {
                log(`âš™ï¸ è¯·æ±‚æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œ: ${chainName}...`, 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_addEthereumChain',
                    params: [customConfig]
                });
                log(`âœ… è‡ªå®šä¹‰ç½‘ç»œ ${chainName} æ·»åŠ æˆåŠŸ!`, 'success');
                
                // æ¸…ç©ºè¡¨å•å¹¶éšè—
                hideCustomNetworkForm();
            } catch (error) {
                log(`âŒ æ·»åŠ è‡ªå®šä¹‰ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆ‡æ¢ç½‘ç»œåŠŸèƒ½
        async function switchNetwork() {
            if (!selectedWallet) return;
            
            try {
                log('ğŸ”„ æµ‹è¯•åˆ‡æ¢ç½‘ç»œ (åˆ‡æ¢åˆ° Polygon)...', 'info');
                await switchToChain('0x89'); // Polygon
            } catch (error) {
                log(`âŒ åˆ‡æ¢ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function switchToChain(chainId) {
            if (!selectedWallet) {
                log('âŒ è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
                return;
            }
            
            const networkName = getNetworkName(chainId);
            
            try {
                log(`ğŸ”„ å°è¯•åˆ‡æ¢åˆ° ${networkName} (${chainId})...`, 'info');
                await selectedWallet.provider.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: chainId }]
                });
                log(`âœ… æˆåŠŸåˆ‡æ¢åˆ° ${networkName}!`, 'success');
                
                // æ›´æ–°å½“å‰é“¾ä¿¡æ¯
                await getChainId();
            } catch (error) {
                if (error.code === 4902) {
                    log(`âš ï¸ ç½‘ç»œ ${networkName} ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ·»åŠ è¯¥ç½‘ç»œ`, 'warn');
                } else {
                    log(`âŒ åˆ‡æ¢åˆ° ${networkName} å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // Solana ç½‘ç»œé…ç½®
        const SOLANA_NETWORKS = {
            mainnet: {
                name: "Solana Mainnet",
                endpoint: "https://api.mainnet-beta.solana.com"
            },
            devnet: {
                name: "Solana Devnet",
                endpoint: "https://api.devnet.solana.com"
            },
            testnet: {
                name: "Solana Testnet",
                endpoint: "https://api.testnet.solana.com"
            }
        };

        // æ£€æŸ¥æ˜¯å¦æœ‰ Solana é’±åŒ…ï¼ˆå¦‚ Phantomï¼‰
        function getSolanaProvider() {
            if ('solana' in window) {
                return window.solana;
            }
            return null;
        }

        // åˆ‡æ¢åˆ° Solana ç½‘ç»œçš„æµ‹è¯•åŠŸèƒ½
        async function switchToSolana(networkKey = 'mainnet') {
            const provider = getSolanaProvider();
            const network = SOLANA_NETWORKS[networkKey];
            if (!provider) {
                log('âŒ æœªæ£€æµ‹åˆ° Solana é’±åŒ…ï¼ˆå¦‚ Phantomï¼‰', 'error');
                return;
            }
            try {
                log(`ğŸ”„ å°è¯•è¿æ¥ ${network.name}...`, 'info');
                // Phantom é’±åŒ…æ”¯æŒ connect æ–¹æ³•
                const resp = await provider.connect();
                log(`âœ… å·²è¿æ¥ Solana é’±åŒ…: ${resp.publicKey.toString()}`, 'success');
                log(`ğŸŒ å½“å‰ç½‘ç»œ: ${network.name} (${network.endpoint})`, 'info');
            } catch (err) {
                log(`âŒ è¿æ¥ Solana é’±åŒ…å¤±è´¥: ${err.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æµ‹
        window.addEventListener('load', () => {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹ EIP-6963 æµ‹è¯•', 'info');
            setTimeout(detectWallets, 500);
        });
    </script>
</body>
</html>