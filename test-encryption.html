<!DOCTYPE html>
<html>
<head>
    <title>测试密码加密助记词</title>
    <style>
        body {
            font-family: monospace;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #00ff00;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: #333;
            border-radius: 5px;
        }
        .data {
            word-break: break-all;
            background: #000;
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
            color: #ffff00;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .highlight {
            color: #ff6600;
            font-weight: bold;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <h1>🔐 密码加密助记词详解</h1>
    
    <div class="section">
        <h3>🎯 测试参数</h3>
        <div class="step">
            <strong>用户密码:</strong> <span class="highlight">mypassword123</span>
        </div>
        <div class="step">
            <strong>示例助记词:</strong> <span class="highlight">abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about</span>
        </div>
    </div>

    <button onclick="demonstrateEncryption()">🚀 开始演示加密过程</button>

    <div id="results"></div>

    <script>
        function demonstrateEncryption() {
            const results = document.getElementById('results');
            results.innerHTML = '';

            // 模拟钱包状态
            const walletState = {
                isLocked: false,
                accounts: [{
                    address: "0x742d35Cc6065C0532C30c0C93c0f1C6F47c5c4F3",
                    privateKey: "0x4c0883a69102937d6231471b5dbb6204fe5129617082792ae468d01a3f362318",
                    publicKey: "",
                    index: 0
                }],
                currentAccount: 0,
                mnemonic: "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about",
                networks: [
                    {
                        name: "Ethereum Mainnet",
                        rpcUrls: ["https://mainnet.infura.io/v3/YOUR-PROJECT-ID"],
                        chainId: 1,
                        symbol: "ETH"
                    }
                ],
                currentNetwork: 0
            };

            const password = "mypassword123";

            console.log('🔄 开始加密演示...');

            // 第1步：JSON序列化
            addSection('第1步：将钱包状态转换为JSON字符串', 
                '将包含助记词的钱包状态对象转换为字符串');
            
            const jsonString = JSON.stringify(walletState, null, 2);
            console.log('📄 JSON字符串:', jsonString);
            
            addStep('原始JSON数据 (包含助记词):', jsonString);

            // 第2步：加密
            addSection('第2步：使用AES算法加密', 
                '使用用户密码作为密钥，AES-256-CBC模式加密');

            const encrypted = CryptoJS.AES.encrypt(jsonString, password).toString();
            console.log('🔐 加密结果:', encrypted);
            
            addStep('密码:', password);
            addStep('加密后的数据:', encrypted);

            // 第3步：解析加密结果
            addSection('第3步：解析加密结果结构', 
                'CryptoJS 生成的加密字符串包含多个部分');

            // 解析 CryptoJS 格式
            const encryptedObj = CryptoJS.enc.Base64.parse(encrypted);
            addStep('加密数据长度:', encrypted.length + ' 字符');
            addStep('编码格式:', 'Base64');
            addStep('包含内容:', 'IV (初始化向量) + 加密的数据');

            // 第4步：解密验证
            addSection('第4步：解密验证', 
                '使用相同密码解密，验证加密的正确性');

            try {
                const decrypted = CryptoJS.AES.decrypt(encrypted, password).toString(CryptoJS.enc.Utf8);
                const decryptedObj = JSON.parse(decrypted);
                
                console.log('✅ 解密成功:', decryptedObj);
                
                addStep('解密结果:', '✅ 成功');
                addStep('恢复的助记词:', decryptedObj.mnemonic);
                addStep('恢复的地址:', decryptedObj.accounts[0].address);
                
            } catch (error) {
                addStep('解密结果:', '❌ 失败: ' + error.message);
            }

            // 第5步：错误密码测试
            addSection('第5步：错误密码测试', 
                '使用错误密码尝试解密');

            try {
                const wrongDecrypted = CryptoJS.AES.decrypt(encrypted, "wrongpassword").toString(CryptoJS.enc.Utf8);
                const wrongObj = JSON.parse(wrongDecrypted);
                addStep('错误密码解密:', '❌ 不应该成功');
            } catch (error) {
                addStep('错误密码解密:', '✅ 正确失败: ' + error.message);
                console.log('✅ 错误密码正确地解密失败');
            }

            // 安全性分析
            addSection('🛡️ 安全性分析', 
                '这种加密方式的安全特点');
            
            addStep('算法强度:', 'AES-256 是军用级加密算法');
            addStep('密钥来源:', '直接使用用户密码 (可能存在弱密码风险)');
            addStep('存储位置:', '浏览器本地存储 (chrome.storage.local)');
            addStep('攻击向量:', '暴力破解密码、本地存储访问');
            
            addSection('💡 改进建议', 
                '可以增强安全性的方法');
            
            addStep('密钥派生:', '使用 PBKDF2 或 scrypt 从密码派生密钥');
            addStep('盐值:', '添加随机盐值防止彩虹表攻击');
            addStep('迭代次数:', '增加计算成本，减慢暴力破解');
            addStep('硬件安全:', '考虑集成硬件安全模块 (HSM)');
        }

        function addSection(title, description) {
            const results = document.getElementById('results');
            const section = document.createElement('div');
            section.className = 'section';
            section.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
            `;
            results.appendChild(section);
        }

        function addStep(label, content) {
            const results = document.getElementById('results');
            const lastSection = results.lastElementChild;
            const step = document.createElement('div');
            step.className = 'step';
            step.innerHTML = `
                <strong>${label}</strong>
                <div class="data">${content}</div>
            `;
            lastSection.appendChild(step);
        }

        // 页面加载时显示说明
        window.onload = function() {
            console.log('🚀 密码加密助记词演示页面已加载');
            console.log('🔍 点击按钮查看完整的加密过程');
        };
    </script>
</body>
</html>
